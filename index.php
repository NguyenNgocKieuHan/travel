<?php
$activate = "index";
include('inc/header.php');
?>

<style>

</style>

<div class="hero overlay py-0 bg-white">
    <div class="img-bg rellax">
        <img src="images/nen.jpg" alt="Image" class="img-fluid">
    </div>

    <div class="container">
        <div class="row align-items-center justify-content-start">
            <div class="col-lg-12 mx-auto text-center">

                <h1 class="heading" data-aos="fade-up">CẦN THƠ - ĐÔ THỊ MIỀN SÔNG NƯỚC</h1>
                <p class="mb-5" data-aos="fade-up">Là thành phố trung tâm vùng ĐBSCL, đầu mối giao thông nối liền giữa
                    các địa phương trong vùng với miền Đông Nam Bộ và đi cả nước.</p>
                <div data-aos="fade-up">
                    <a href="https://youtu.be/NhJrf3F1hCI?t=126"
                        class="play-button align-items-center d-flex glightbox3">
                        <span class="icon-button me-3">
                            <span class="icon-play"></span>
                        </span>
                        <span class="caption">Watch Video</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class=" section section-2">
    <div class="container">
        <div class="row align-items-center justify-content-between">
            <div class="col-lg-6 order-lg-2 mb-5 mb-lg-0">
                <div class="image-stack mb-5 mb-lg-0">
                    <div class="image-stack__item image-stack__item--bottom" data-aos="fade-up">
                        <img src="images/img_v_1.jpg" alt="Image" class="img-fluid rellax ">
                    </div>
                    <div class="image-stack__item image-stack__item--top" data-aos="fade-up" data-aos-delay="100"
                        data-rellax-percentage="0.5">
                        <img src="images/img_v_2.jpg" alt="Image" class="img-fluid">
                    </div>
                </div>

            </div>
            <div class="col-lg-4 order-lg-1">

                <div>
                    <h2 class="heading mb-3" data-aos="fade-up" data-aos-delay="100">THÀNH PHỐ CẦN THƠ</h2>

                    <p data-aos="fade-up" data-aos-delay="200">Cần Thơ là thành phố trực thuộc Trung ương, nằm ở vị
                        trí
                        trung tâm của vùng đồng bằng sông Cửu Long. Vốn được mệnh danh là Tây Đô – Thủ phủ của miền
                        Tây
                        Nam bộ từ hơn trăm năm trước, giờ đây Cần Thơ đã trở thành đô thị loại I trực thuộc Trung
                        ương
                        và là một trong 4 tỉnh thuộc vùng kinh tế trọng điểm của vùng đồng bằng sông Cửu Long và là
                        vùng
                        kinh tế trọng điểm thứ tư của Việt Nam. </p>

                    <p data-aos="fade-up" data-aos-delay="300">Cần Thơ đang hướng tới mục tiêu trở thành thành phố
                        đồng
                        bằng cấp quốc gia, văn minh, hiện đại, xanh, sạch đẹp, là trung tâm công nghiệp, trung tâm
                        thương mại – dịch vụ, trung tâm giáo dục đào tạo và khoa học công nghệ, trung tâm y tế và
                        văn
                        hóa của vùng.</p>
                    <!-- 
                    <p class="my-4" data-aos="fade-up" data-aos-delay="300"><a
                            href="https://vi.wikipedia.org/wiki/C%E1%BA%A7n_Th%C6%A1" class="btn btn-primary">Xem
                            thêm</a></p> -->
                </div>
            </div>

        </div>

    </div>
</div>
<div class="box-image">
    <h2 class="heading mb-5 text-center">CÁC ĐỊA ĐIỂM HẤP DẪN TẠI CẦN THƠ</h2>
    <div class="row p-0 m-0">
        <div class="image-container">
            <img src="images/nhaco.jpg" alt="Image">
            <div class="overlay">
                <p class="image-text">NHÀ CỔ BÌNH THỦY</p>
            </div>
        </div>

        <div class="image-container">
            <img src="images/conson.jpg" alt="Image">
            <div class="overlay">
                <p class="image-text">CỒN SƠN</p>
            </div>
        </div>
        <div class="image-container">
            <img src="images/img-1.jpg" alt="Image">
            <div class="overlay">
                <p class="image-text">CHỢ NỔI CÁI RĂNG</p>
            </div>
        </div>
        <div class="image-container">
            <img src="images/benninhkieu.webp" alt="Image">
            <div class="overlay">
                <p class="image-text">BẾN NINH KIỀU</p>
            </div>
        </div>
        <div class="image-container">
            <img src="images/ongde.jpg" alt="Image">
            <div class="overlay">
                <p class="image-text">KHU DU LỊCH SINH THÁI ÔNG ĐỀ</p>
            </div>
        </div>
        <div class="image-container">
            <img src="images/mykhanh.webp" alt="Image">
            <div class="overlay">
                <p class="image-text">LÀNG DU LỊCH MỸ KHÁNH CẦN THƠ</p>
            </div>
        </div>
    </div>
</div>

<div class="section section-3" data-aos="fade-up" data-aos-delay="100">
    <div class="container">
        <div class="row align-items-center justify-content-between  mb-5">
            <div class="col-lg-5" data-aos="fade-up">
                <h2 class="heading mb-3">Khám phá hàng trăm điểm đến du lịch</h2>
                <p>Nhắc tới Cần Thơ là nhắc tới vùng quê gạo trắng nước trong, với những khung cảnh nên thơ
                    trữ
                    tình.
                    Nơi đây còn nổi tiếng với những cánh đồng lúa thẳng cánh cò bay, có vườn cây trĩu quả
                    cùng
                    mạng lưới
                    kênh rạch chằng chịt, những ngôi nhà với kiến trúc độc đáo.</p>
            </div>
            <div class="col-lg-5 text-md-end" data-aos="fade-up" data-aos-delay="100">
                <div id="destination-controls">
                    <span class="prev me-3" data-controls="prev">
                        <span class="icon-chevron-left"></span>
                    </span>
                    <span class="next" data-controls="next">
                        <span class="icon-chevron-right"></span>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="section section-3" data-aos="fade-up" data-aos-delay="10">
    <div class="destination-slider-wrap">
        <!-- <div class="destination-slider"> -->
        <!-- <div class="destination"> -->
        <div class="container">
            <div class="row"
                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); grid-gap: 20px;">
                <?php

                        include('connect.php');

                        $query = "SELECT tour.*, loaitour.LT_TEN, review.*, khachhang.KH_HOTEN
                            FROM tour
                            LEFT JOIN loaitour ON tour.LT_MA = loaitour.LT_MA
                            LEFT JOIN review ON tour.T_MA = review.T_MA
                            LEFT JOIN khachhang ON review.KH_MA = khachhang.KH_MA
                            WHERE review.R_RATING = '5'
";

                        $result = mysqli_query($conn, $query);

                        if (!$result) {
                            die("Lỗi trong quá trình truy vấn cơ sở dữ liệu: " . mysqli_error($conn));
                        }

                        mysqli_query($conn, "SET NAMES 'utf8'");
                        while ($row = mysqli_fetch_array($result)) {
                            // Lấy mã tour của tour hiện tại
                            $current_T_MA = $row['T_MA'];

                            // Truy vấn đánh giá của tour hiện tại
                            $sql_reviews = "SELECT R_RATING FROM review WHERE T_MA = '$current_T_MA'";
                            $result_reviews = mysqli_query($conn, $sql_reviews);

                            // Khởi tạo biến để tính điểm trung bình và số lượng đánh giá
                            $total_rating = 0;
                            $num_reviews = 0;

                            // Duyệt qua các đánh giá và tính tổng điểm và số lượng đánh giá
                            while ($review_row = mysqli_fetch_assoc($result_reviews)) {
                                $total_rating += $review_row['R_RATING'];
                                $num_reviews++;
                            }

                            // Tính điểm trung bình nếu có đánh giá
                            if ($num_reviews > 0) {
                                $avg_rating = $total_rating / $num_reviews;
                            } else {
                                $avg_rating = 0; // Đặt điểm trung bình là 0 nếu không có đánh giá
                            }
                        ?>
                <div class="card" style="width: 100%;">
                    <img src="images/<?php echo $row["T_HINHANH"]; ?>" class="card-img-top" alt="..."
                        style="width: 100%; height: 200px; object-fit: contain">
                    <div class="card-body">
                        <div class="row">
                            <p class="col-4"><?php echo $row['LT_TEN'] ?></p>
                            <p class="col-4"><?php echo $row['T_NGAYKHOIHANH'] ?></p>
                            <p class="col-4"><?php echo number_format($avg_rating, 1) . "/5 "; ?>★</p>
                        </div>
                        <h5 class="card-title text-dark pt-2"><?php echo $row["T_TEN"]; ?></h5>
                        <div class="row m-0 p-0 d-flex justify-content-center">
                            <a class="col-5 btn btn-primary"><?php echo number_format($row['T_GIA'], 0, ",", ".") ?></a>
                            <a class="col-5 btn btn-primary" href="chitiettour.php?T_MA=<?php echo $row["T_MA"]; ?>">Chi
                                tiết</a>
                        </div>
                    </div>
                </div>
                <?php
                        }
                        ?>
            </div>

        </div>
    </div>
</div>

</div>
<div class="section bg-light">
    <h2 class="heading mb-5 text-center">Lời chứng thực</h2>
    <div class="text-center mb-5">
        <div id="prevnext-testimonial">
            <span class="prev me-3" data-controls="prev">
                <span class="icon-chevron-left"></span>
            </span>
            <span class="next" data-controls="next">
                <span class="icon-chevron-right"></span>

            </span>
        </div>
    </div>

    <div class="wide-slider-testimonial-wrap">
        <div class="wide-slider-testimonial">
            <?php

$query = "SELECT review.*, khachhang.KH_HOTEN
          FROM review
          LEFT JOIN khachhang ON review.KH_MA = khachhang.KH_MA
          WHERE review.R_RATING = 5";

$result = mysqli_query($conn, $query);

if (!$result) {
    die("Lỗi trong quá trình truy vấn cơ sở dữ liệu: " . mysqli_error($conn));
}

            // Lặp qua các hàng kết quả trả về từ truy vấn
            while ($row = mysqli_fetch_assoc($result)) {
                echo '<div class="item">';
                echo '<blockquote class="block-testimonial">';
                echo '<div class="author">';
                echo '<img src="images/huou.jpg" alt="Free template by TemplateUX">';
                // Hiển thị tên người đánh giá và chức vụ (nếu có)
                echo '<h3>' . $row['KH_HOTEN'] . '</h3>';
                echo '<p>' . $row['R_COMMENT'] . '</p>';
                echo '<p class="position mb-5">Rating: ';
                // Hiển thị biểu tượng số sao tương ứng
                $rating = intval($row['R_RATING']); // Lấy phần nguyên của rating
                for ($i = 0; $i < $rating; $i++) {
                    echo '<i class="fas fa-star"></i>'; // Sử dụng Font Awesome icon cho từng sao
                }

                echo '</p>';
                echo '</div>';
                echo '</blockquote>';
                echo '</div>';
            }
            ?>
        </div>
    </div>
</div>



<?php
// Giải phóng bộ nhớ sau khi sử dụng kết quả truy vấn
mysqli_free_result($result);

// Đóng kết nối
mysqli_close($conn);

include('inc/footer.php');
?>